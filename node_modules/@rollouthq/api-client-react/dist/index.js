var A=Object.create;var l=Object.defineProperty,O=Object.defineProperties,h=Object.getOwnPropertyDescriptor,E=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertyNames,y=Object.getOwnPropertySymbols,w=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var d=(t,e,r)=>e in t?l(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,R=(t,e)=>{for(var r in e||(e={}))Q.call(e,r)&&d(t,r,e[r]);if(y)for(var r of y(e))M.call(e,r)&&d(t,r,e[r]);return t},T=(t,e)=>O(t,E(e));var z=(t,e)=>{for(var r in e)l(t,r,{get:e[r],enumerable:!0})},P=(t,e,r,u)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of q(e))!Q.call(t,o)&&o!==r&&l(t,o,{get:()=>e[o],enumerable:!(u=h(e,o))||u.enumerable});return t};var I=(t,e,r)=>(r=t!=null?A(w(t)):{},P(e||!t||!t.__esModule?l(r,"default",{value:t,enumerable:!0}):r,t)),B=t=>P(l({},"__esModule",{value:!0}),t);var H={};z(H,{RolloutAPIClientProvider:()=>F,useLazyQuery:()=>D,useMutation:()=>G,useQuery:()=>b,useRolloutAPIClientContext:()=>v,useTRPCContext:()=>L});module.exports=B(H);var x=I(require("assert")),m=require("@trpc/client"),g=require("@trpc/react"),n=I(require("react")),s=require("react-query"),i=(0,g.createReactQueryHooks)(),b=i.useQuery,G=i.useMutation,L=i.useContext;function D(t){let{client:e}=i.useContext(),[r,u]=(0,n.useState)(),[o,c]=(0,n.useState)(!1),a=(0,s.useQuery)([t,r],()=>((0,x.default)(r!=null),e.query(t,r)),{enabled:o}),p=C=>{u(C),c(!0)};return T(R({},a),{fetch:p,input:r})}function F(t){let{token:e,apiBaseUrl:r,children:u}=t,o=(0,n.useRef)(void 0),c=(0,n.useCallback)(async()=>typeof e=="string"?e:(o.current==null&&(o.current=await e()),o.current),[e]),[a]=(0,n.useState)(()=>new s.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry(U,f){if(f instanceof m.TRPCClientError){if(f.data.code==="NOT_FOUND")return!1;if(f.data.code==="UNAUTHORIZED")return o.current=void 0,!0}return!0}}}})),[p]=(0,n.useState)(()=>i.createClient({url:`${r}/trpc`,async headers(){return{authorization:`Bearer ${await c()}`}}})),C=(0,n.useMemo)(()=>({getToken:c,apiBaseUrl:r}),[r]);return n.default.createElement(k.Provider,{value:C},n.default.createElement(i.Provider,{client:p,queryClient:a},n.default.createElement(s.QueryClientProvider,{client:a},u)))}var k=(0,n.createContext)(void 0);function v(){var e;let t=(0,n.useContext)(k);if(!t){let r=new Error("No RolloutAPIClientContext provided");throw r.name="ContextError",(e=Error.captureStackTrace)==null||e.call(Error,r,v),r}return t}0&&(module.exports={RolloutAPIClientProvider,useLazyQuery,useMutation,useQuery,useRolloutAPIClientContext,useTRPCContext});
//# sourceMappingURL=index.js.map